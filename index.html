<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ovrnet.com // terminal</title>
    <style>
        body, html { margin: 0; padding: 0; background: #050505; color: #00ff41; font-family: 'Courier New', Courier, monospace; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.3; }
        .crt-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 2px, 3px 100%; pointer-events: none; z-index: 10; }
        #terminal { padding: 20px; height: 90vh; overflow-y: auto; text-shadow: 0 0 5px #00ff41; }
        .input-line { display: flex; align-items: center; position: relative; width: 100%; }
        #cmd-input { 
            background: transparent; 
            border: none; 
            color: #00ff41; 
            outline: none; 
            font-family: inherit; 
            font-size: 1rem; 
            width: auto; 
            flex-grow: 1; 
            caret-color: transparent; /* Hide the default browser cursor */
        }
        .prompt { color: #ff00ff; margin-right: 10px; }
        .output { margin-bottom: 10px; white-space: pre-wrap; }
        #cursor-glow { position: fixed; width: 400px; height: 400px; background: radial-gradient(circle, rgba(0,255,65,0.05) 0%, transparent 70%); pointer-events: none; transform: translate(-50%, -50%); z-index: 5; }
        .cursor { 
            width: 10px; 
            height: 1.2rem; 
            background: #00ff41; 
            animation: blink 1s infinite; 
            position: absolute;
            pointer-events: none;
        }
        @keyframes blink { 0%, 49% { opacity: 1; } 50%, 100% { opacity: 0; } }

        #paste-area { 
            display: none; 
            width: 100%; 
            height: 300px; 
            background: rgba(0, 255, 65, 0.05); 
            border: 1px solid #00ff41; 
            color: #00ff41; 
            font-family: inherit; 
            padding: 10px; 
            box-sizing: border-box;
            outline: none;
            margin-top: 10px;
        }
        .link-output { color: #ffff00; text-decoration: underline; cursor: pointer; word-break: break-all; }
        
        .qr-container { 
            background: #00ff41; 
            padding: 10px; 
            display: inline-block; 
            margin-top: 10px;
            border: 2px solid #00ff41;
        }
        .qr-container canvas, .qr-container img {
            /* This makes the QR code look like it's part of the terminal */
            filter: brightness(0.5) contrast(2);
        }
    </style>
    <script src="qrcode.min.js"></script>
</head>
<body>
    <div class="crt-overlay"></div>
    <div id="cursor-glow"></div>
    <canvas id="canvas"></canvas>
    <div id="terminal">
        <div class="output">OVRNET(tm) Kernel 1.0.9-p2 (tty0)
Connecting to IRC... [OK]
Type 'help' for available commands.</div>
        <div id="history"></div>
        <textarea id="paste-area" placeholder="Paste your code here... (Ctrl+Enter to save)"></textarea>
        <div class="input-line">
            <span class="prompt">root@ovrnet:~#</span>
            <input type="text" id="cmd-input" autofocus spellcheck="false">
            <div class="cursor"></div>
        </div>
    </div>

    <script>
        // 1. Matrix Background
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789$+-*/=%\"'#&_(),.;:?!\\|{}<>[]";
        const fontSize = 14;
        const columns = canvas.width / fontSize;
        const drops = Array(Math.floor(columns)).fill(1);
        function drawMatrix() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#00ff41";
            ctx.font = fontSize + "px monospace";
            for (let i = 0; i < drops.length; i++) {
                const text = chars.charAt(Math.floor(Math.random() * chars.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 35);

        // 2. Mouse Effect
        const glow = document.getElementById('cursor-glow');
        window.addEventListener('mousemove', e => {
            glow.style.left = e.clientX + 'px';
            glow.style.top = e.clientY + 'px';
            glow.style.opacity = (Math.random() * 0.1 + 0.2).toString();
        });

        // 3. Terminal Logic
        const input = document.getElementById('cmd-input');
        const history = document.getElementById('history');
        const cursor = document.querySelector('.cursor');
        const pasteArea = document.getElementById('paste-area');
        const fs = {
            'about.txt': 'OVRNET: The next generation of decentralized IRC networks.',
            'contact.txt': 'IRC: #ovrnet on EFNet\nMail: admin@ovrnet.com',
            'projects': { 'bot.sh': '#!/bin/bash\necho "Scanning..."', 'core.c': '// Kernel source' }
        };
        let currentDir = fs;

        async function compressAndEncode(text) {
            const stream = new Blob([text]).stream();
            const compressedStream = stream.pipeThrough(new CompressionStream('gzip'));
            const chunks = [];
            const reader = compressedStream.getReader();
            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                chunks.push(value);
            }
            const buffer = await new Blob(chunks).arrayBuffer();
            return btoa(String.fromCharCode(...new Uint8Array(buffer)))
                .replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
        }

        async function decodeAndDecompress(base64) {
            try {
                const binary = atob(base64.replace(/-/g, '+').replace(/_/g, '/'));
                const buffer = Uint8Array.from(binary, c => c.charCodeAt(0));
                const stream = new Blob([buffer]).stream();
                const decompressedStream = stream.pipeThrough(new DecompressionStream('gzip'));
                const result = await new Response(decompressedStream).text();
                return result;
            } catch (e) {
                return "Error: Could not decode data.";
            }
        }

        function updateCursorPos() {
            const span = document.createElement('span');
            span.style.visibility = 'hidden';
            span.style.position = 'absolute';
            span.style.whiteSpace = 'pre';
            span.style.font = window.getComputedStyle(input).font;
            span.textContent = input.value;
            document.body.appendChild(span);
            
            const width = span.getBoundingClientRect().width;
            const promptWidth = document.querySelector('.prompt').getBoundingClientRect().width;
            
            cursor.style.left = (promptWidth + width + 10) + 'px';
            document.body.removeChild(span);
        }

        input.addEventListener('input', updateCursorPos);
        updateCursorPos();

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const val = input.value.trim();
                const line = document.createElement('div');
                line.innerHTML = `<span class="prompt">root@ovrnet:~#</span> ${val}`;
                history.appendChild(line);
                processCmd(val);
                input.value = '';
                updateCursorPos();
                window.scrollTo(0, document.body.scrollHeight);
            }
        });

        pasteArea.addEventListener('keydown', async (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                const text = e.target.value;
                if (!text) return;
                const hash = await compressAndEncode(text);
                const url = window.location.origin + window.location.pathname + '#' + hash;
                
                out('--- PASTE GENERATED ---');
                const link = document.createElement('div');
                link.className = 'link-output';
                link.textContent = url;
                link.onclick = () => { 
                    navigator.clipboard.writeText(url); 
                    out('Link copied to clipboard!'); 
                };
                history.appendChild(link);
                
                e.target.style.display = 'none';
                e.target.value = '';
                input.focus();
            }
        });

        function out(text) {
            const div = document.createElement('div');
            div.className = 'output';
            div.textContent = text;
            history.appendChild(div);
        }

        function processCmd(cmd) {
            const parts = cmd.split(' ');
            const command = parts[0].toLowerCase();
            switch(command) {
                case 'help': out('Available: ls, cd, cat, uname, ifconfig, ping, df, ps, w, whoami, date, uptime, echo, clear, exit, new, qr'); break;
                case 'ls': out(Object.keys(currentDir).join('  ')); break;
                case 'uname': out('OVRNET-OS 1.0.0-release x86_64'); break;
                case 'whoami': out('root'); break;
                case 'date': out(new Date().toString()); break;
                case 'uptime': out('up 42 days, 14:23, 1 user, load average: 0.08, 0.03, 0.01'); break;
                case 'echo': out(parts.slice(1).join(' ')); break;
                case 'ifconfig': out('eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500\ninet 192.168.1.101 netmask 255.255.255.0'); break;
                case 'ping': out('PING ovrnet.com (1.1.1.1): 56 data bytes\n64 bytes from 1.1.1.1: icmp_seq=0 ttl=64 time=1.02 ms'); break;
                case 'df': out('Filesystem     Used  Available Capacity Mounted on\n/dev/sda1      42G   540G      8%       /'); break;
                case 'ps': out('PID TTY          TIME CMD\n 124 tty0     00:00:01 bash\n 542 tty0     00:00:00 ps'); break;
                case 'w': out(' 12:00:01 up 42 days, 1 user, load average: 0.01'); break;
                case 'cat': 
                    const file = parts[1];
                    if (!file) { out('usage: cat [file]'); break; }
                    out(currentDir[file] || 'File not found');
                    break;
                case 'new':
                    out('Entering PASTE mode. Type your text in the box above. Press Ctrl+Enter to generate link.');
                    pasteArea.style.display = 'block';
                    pasteArea.focus();
                    break;
                case 'qr':
                    const currentUrl = window.location.href;
                    if (!window.location.hash) {
                        out('Error: No paste data found. Create a paste with "new" first.');
                        break;
                    }
                    out('Generating QR Code for current paste...');
                    
                    const qrDiv = document.createElement('div');
                    qrDiv.className = 'qr-container';
                    history.appendChild(qrDiv);
                    
                    new QRCode(qrDiv, {
                        text: currentUrl,
                        width: 128,
                        height: 128,
                        colorDark : "#000000",
                        colorLight : "#00ff41",
                        correctLevel : QRCode.CorrectLevel.H
                    });
                    out('Scan to open this paste on mobile.');
                    break;
                case 'exit': out('Session terminated. Please close your browser.'); input.disabled = true; break;
                case 'clear': history.innerHTML = ''; break;
                default: if(cmd) out(`command not found: ${command}`);
            }
        }

        window.addEventListener('load', async () => {
            const hash = window.location.hash.substring(1);
            if (hash) {
                out('--- DECODING INCOMING PASTE ---');
                const decoded = await decodeAndDecompress(hash);
                out(decoded);
                out('--- END OF PASTE ---');
            }
        });
    </script>
</body>
</html>
